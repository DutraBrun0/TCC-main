<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lista de Clientes - Mev Glass OS</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header>
<h1><a href="{{ url_for('inicio_page') }}">prodmanager</a></h1>
  <nav>
    <a href="{{ url_for('produtos_page') }}">Produtos</a>
    <a href="{{ url_for('clientes_page') }}">Cadastrar Cliente</a>
    <a href="{{ url_for('estoque_page') }}">Estoque</a>
    <a href="{{ url_for('faturamento_page') }}">Faturamento</a>
  </nav>
</header>

<main>
  <section>
    <h2>Clientes Cadastrados</h2>
    <table id="clientes-table">
      <thead><tr><th>Nome</th><th>Email</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script>
  let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');

  function updateClientesTable() {
    const tbody = document.querySelector('#clientes-table tbody');
    tbody.innerHTML = '';

    clientes.forEach((c, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${c.nome}</td>
        <td>${c.email}</td>
      `;

      // Evento de duplo clique para exclusÃ£o
      row.addEventListener('dblclick', () => {
        if (confirm(`Deseja excluir o cliente "${c.nome}"?`)) {
          excluirCliente(index);
        }
      });

      tbody.appendChild(row);
    });

    localStorage.setItem('clientes', JSON.stringify(clientes));
  }

  function excluirCliente(index) {
    // Remove vendas relacionadas
    let faturamentos = JSON.parse(localStorage.getItem('faturamentos') || '[]');
    faturamentos = faturamentos.filter(f => f.cliente !== index);

    faturamentos = faturamentos.map(f => {
      if (f.cliente > index) f.cliente -= 1;
      return f;
    });

    localStorage.setItem('faturamentos', JSON.stringify(faturamentos));
    clientes.splice(index, 1);
    updateClientesTable();
  }

  updateClientesTable();
</script>
</body>
</html>
