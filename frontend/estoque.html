<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Estoque - Mev Glass OS</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
    /* --- ESTILO CLEAN & SUAVE (PADRÃO MEV GLASS) --- */
    :root {
        --bg-body: #f8fafc;
        --bg-card: #ffffff;
        --bg-container: #f1f5f9; /* Fundo do bloco interno */
        --border-subtle: #e2e8f0;
        --text-main: #334155;
        --text-muted: #64748b;
        --primary: #0f172a; 
        --blue-btn: #3b82f6;
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --danger: #ef4444;
    }

    body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        margin: 0;
        padding-bottom: 60px;
    }

    /* Header */
    header {
        background: var(--bg-card);
        border-bottom: 1px solid var(--border-subtle);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    header h1 a { color: var(--primary); text-decoration: none; font-weight: 700; font-size: 1.2rem; }
    nav a { color: var(--text-muted); text-decoration: none; margin-left: 20px; font-size: 0.9rem; transition: 0.2s; }
    nav a:hover { color: var(--primary); }

    /* Layout Styles */
    main { max-width: 950px; margin: 40px auto; padding: 0 20px; } /* Um pouco mais largo para a tabela */

    /* Card Principal */
    .card {
        background: var(--bg-card);
        padding: 40px;
        border-radius: 16px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-subtle);
    }

    .page-header { margin-bottom: 30px; }
    h2 { font-weight: 600; color: var(--primary); margin: 0 0 5px 0; font-size: 1.5rem; }
    .subtitle { color: var(--text-muted); font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }

    /* --- BLOCO DA TABELA (O "Bloco Dentro") --- */
    .table-container {
        background-color: var(--bg-container);
        border: 1px dashed var(--border-subtle);
        border-radius: 12px;
        padding: 20px;
        overflow-x: auto; /* Garante rolagem se a tabela for muito larga */
    }

    /* Estilização da Tabela Clean */
    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        text-align: left;
    }

    thead tr {
        background-color: transparent;
    }

    th {
        padding: 12px 15px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        border-bottom: 2px solid var(--border-subtle);
    }

    td {
        padding: 15px;
        font-size: 0.95rem;
        color: var(--text-main);
        border-bottom: 1px solid #e2e8f0;
        background-color: #fff; /* Linhas brancas */
    }

    /* Arredondar cantos da primeira e última linha para estética */
    tbody tr:first-child td:first-child { border-top-left-radius: 8px; }
    tbody tr:first-child td:last-child { border-top-right-radius: 8px; }
    tbody tr:last-child td:first-child { border-bottom-left-radius: 8px; }
    tbody tr:last-child td:last-child { border-bottom-right-radius: 8px; }
    
    /* Remove borda da última linha */
    tbody tr:last-child td { border-bottom: none; }

    /* Hover na linha */
    tbody tr { cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; }
    tbody tr:hover td {
        background-color: #f8fafc; /* Leve destaque ao passar o mouse */
        color: var(--primary);
    }

    /* Destaques específicos */
    .sku-tag {
        font-family: monospace;
        background: #f1f5f9;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        color: var(--text-muted);
    }
    
    .qtd-destaque {
        font-weight: 700;
        color: var(--blue-btn); /* Azul do tema */
    }

</style>
</head>

<body>
<header>
<h1><a href="{{ url_for('inicio_page') }}">prodmanager</a></h1>
  <nav>
    <a href="{{ url_for('produtos_page') }}">Produtos</a>
    <a href="{{ url_for('clientes_page') }}">Clientes</a>
    <a href="{{url_for('lista_cliente_page')}}">Lista Clientes</a>
    <a href="{{ url_for('estoque_page') }}">Estoque</a>
    <a href="{{ url_for('faturamento_page') }}">Faturamento</a>
  </nav>
</header>

<main>
    <div class="card">
        <div class="page-header">
            <h2>Controle de Estoque</h2>
            <span class="subtitle">
        
            </span>
        </div>

        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>SKU</th>
                    <th>Produto</th>
                    <th>Dimensões</th>
                    <th>Cor / Moldura</th>
                    <th>Preço Base</th>
                    <th>Quantidade</th>
                </tr>
                </thead>
                <tbody id="tabela-estoque">
                    </tbody>
            </table>
        </div>
    </div>
</main>

<script>
async function carregarEstoque() {
  try {
    const req = await fetch("/estoque/variantes");
    const data = await req.json();

    const tbody = document.getElementById("tabela-estoque");
    tbody.innerHTML = "";

    data.forEach(v => {
      const tr = document.createElement("tr");
      
      // Configurações da linha para exclusão
      tr.dataset.id = v.variante_id;
      tr.title = "Clique duas vezes para excluir este item";

      // Preenche as células
      tr.innerHTML = `
        <td><span class="sku-tag">${v.sku}</span></td>
        <td>${v.nome_produto || v.produto_id}</td>
        <td>${v.altura_cm || ""} x ${v.largura_cm || ""}</td>
        <td>${v.cor || ""} / ${v.moldura || ""}</td>
        <td>R$ ${v.preco_base}</td>
        <td id="qtd-${v.variante_id}" class="qtd-destaque">${v.estoque}</td>
      `;
      
      // Adiciona o evento de CLIQUE DUPLO para excluir
      tr.addEventListener("dblclick", function() {
         if (confirm(`Tem certeza que deseja EXCLUIR o produto SKU: ${v.sku}?`)) {
             excluirProduto(v.variante_id, tr);
         }
      });

      tbody.appendChild(tr);
    });
  } catch (error) {
    console.error("Erro ao carregar estoque:", error);
  }
}

// Nova função para excluir (Desativar) o produto
async function excluirProduto(id, linhaElemento) {
  try {
    const req = await fetch(`/variante/excluir/${id}`, {
      method: "DELETE"
    });
    
    const res = await req.json();

    if (res.status === "ok") {
      // Efeito visual antes de remover
      linhaElemento.style.backgroundColor = "#fee2e2";
      setTimeout(() => {
          linhaElemento.remove();
          alert("Produto excluído com sucesso!");
      }, 200);
    } else {
      alert("Erro ao excluir: " + res.mensagem);
    }
  } catch (error) {
    alert("Erro de conexão com o servidor.");
    console.error(error);
  }
}

// Inicia o carregamento
carregarEstoque();
</script>
</body>
</html>